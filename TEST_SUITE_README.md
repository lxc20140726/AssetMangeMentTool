# èµ„äº§ç®¡ç†å·¥å…· - æµ‹è¯•å¥—ä»¶æ–‡æ¡£

## ğŸ“‹ åŠŸèƒ½æ¢³ç†

### åç«¯åŠŸèƒ½æ¨¡å—

#### 1. è´¦å•ç®¡ç† (Bills Management)
- **GET /api/bills** - è·å–æ‰€æœ‰è´¦å•
- **GET /api/bills/range** - æŒ‰æ—¥æœŸèŒƒå›´è·å–è´¦å•
- **POST /api/bills/import** - å¯¼å…¥Excelè´¦å•æ–‡ä»¶

#### 2. èµ„äº§ç®¡ç† (Assets Management)  
- **GET /api/assets** - è·å–æ‰€æœ‰èµ„äº§
- **POST /api/assets** - åˆ›å»ºæ–°èµ„äº§
- **PUT /api/assets/:id** - æ›´æ–°èµ„äº§é‡‘é¢

#### 3. æ—¥å¿—ç®¡ç† (Logs Management)
- **GET /api/logs** - è·å–ç³»ç»Ÿæ—¥å¿—ï¼Œæ”¯æŒæŒ‰çº§åˆ«å’Œæ—¶é—´èŒƒå›´ç­›é€‰

#### 4. æ•°æ®æ¨¡å‹ (Data Models)
- **billModel** - è´¦å•æ•°æ®æ“ä½œ (create, findAll, findByDateRange)
- **assetModel** - èµ„äº§æ•°æ®æ“ä½œ (create, findAll, update)

#### 5. å·¥å…·æœåŠ¡ (Utilities)
- **Logger** - åŸºäºWinstonçš„æ—¥å¿—ç³»ç»Ÿ
- **æ•°æ®åº“** - åŸºäºbetter-sqlite3çš„SQLiteæ•°æ®åº“
- **æ–‡ä»¶ä¸Šä¼ ** - åŸºäºMulterçš„æ–‡ä»¶å¤„ç†

### å‰ç«¯åŠŸèƒ½æ¨¡å—

#### 1. è´¦å•é¡µé¢ (Bills Page)
- è´¦å•åˆ—è¡¨æ˜¾ç¤º
- æ—¥æœŸèŒƒå›´ç­›é€‰
- è´¦å•å¯¼å…¥åŠŸèƒ½

#### 2. èµ„äº§é¡µé¢ (Assets Page)
- èµ„äº§åˆ—è¡¨ç®¡ç†
- æ–°å¢èµ„äº§å¯¹è¯æ¡†
- èµ„äº§æ›´æ–°åŠŸèƒ½
- èµ„äº§è¯¦æƒ…æŸ¥çœ‹

#### 3. æ•°æ®åˆ†æé¡µé¢ (Analytics Page)
- æ”¯å‡ºåˆ†ç±»ç»Ÿè®¡ (é¥¼å›¾)
- æœˆåº¦æ”¯å‡ºè¶‹åŠ¿ (æŠ˜çº¿å›¾)
- èµ„äº§åˆ†å¸ƒåˆ†æ (é¥¼å›¾)

#### 4. æ”¯å‡ºé¢„æµ‹é¡µé¢ (Forecast Page)
- æ”¯å‡ºé¢„æµ‹å›¾è¡¨
- åˆ†ç±»é¢„æµ‹åˆ†æ
- èµ„äº§å¢é•¿é¢„æµ‹
- é¢„æµ‹å‘¨æœŸé€‰æ‹©

#### 5. æ—¥å¿—é¡µé¢ (Logs Page)
- ç³»ç»Ÿæ—¥å¿—æ˜¾ç¤º
- æ—¥å¿—çº§åˆ«ç­›é€‰
- æ—¶é—´èŒƒå›´ç­›é€‰

#### 6. æ•°æ®å¯¼å…¥é¡µé¢ (Import Page)
- Excelæ–‡ä»¶ä¸Šä¼ 
- å¯¼å…¥æ¨¡æ¿ä¸‹è½½
- å¯¼å…¥è¿›åº¦æ˜¾ç¤º

## ğŸ§ª æµ‹è¯•å¥—ä»¶æ¶æ„

### æµ‹è¯•ç±»å‹æ¦‚è§ˆ

```
æµ‹è¯•å¥—ä»¶æ¶æ„
â”œâ”€â”€ å•å…ƒæµ‹è¯• (Unit Tests)           - ç‹¬ç«‹æ¨¡å—åŠŸèƒ½æµ‹è¯•
â”œâ”€â”€ é›†æˆæµ‹è¯• (Integration Tests)    - APIå’ŒæœåŠ¡é—´äº¤äº’æµ‹è¯•  
â”œâ”€â”€ å†’çƒŸæµ‹è¯• (Smoke Tests)          - åŸºç¡€åŠŸèƒ½å¿«é€ŸéªŒè¯
â””â”€â”€ ç«¯åˆ°ç«¯æµ‹è¯• (E2E Tests)          - å®Œæ•´ç”¨æˆ·æµç¨‹æµ‹è¯•
```

### 1. å•å…ƒæµ‹è¯• (Unit Tests)

**ä½ç½®**: `backend/src/__tests__/unit/`

#### æµ‹è¯•æ–‡ä»¶ç»“æ„
```
backend/src/__tests__/unit/
â”œâ”€â”€ models.test.ts          # æ•°æ®æ¨¡å‹æµ‹è¯•
â””â”€â”€ utils.test.ts           # å·¥å…·å‡½æ•°æµ‹è¯•
```

#### è¦†ç›–åŠŸèƒ½
- **æ•°æ®æ¨¡å‹æµ‹è¯•**
  - billModel: create, findAll, findByDateRange
  - assetModel: create, findAll, update
  - æ•°æ®éªŒè¯å’Œé”™è¯¯å¤„ç†
  - è¾¹ç•Œæ¡ä»¶æµ‹è¯•

- **å·¥å…·å‡½æ•°æµ‹è¯•**
  - Loggeré…ç½®å’Œæ—¥å¿—çº§åˆ«
  - éªŒè¯ä¸­é—´ä»¶ (validateDateRange, validateAsset)
  - ç¯å¢ƒé…ç½®æµ‹è¯•

#### æµ‹è¯•ç‰¹ç‚¹
- ä½¿ç”¨å†…å­˜æ•°æ®åº“è¿›è¡Œéš”ç¦»æµ‹è¯•
- æ¨¡æ‹Ÿå¤–éƒ¨ä¾èµ– (Winston)
- å®Œæ•´çš„é”™è¯¯æƒ…å†µè¦†ç›–

### 2. é›†æˆæµ‹è¯• (Integration Tests)

**ä½ç½®**: `backend/src/__tests__/integration/`

#### æµ‹è¯•æ–‡ä»¶ç»“æ„
```
backend/src/__tests__/integration/
â””â”€â”€ api.test.ts             # APIç«¯ç‚¹é›†æˆæµ‹è¯•
```

#### è¦†ç›–åŠŸèƒ½
- **APIç«¯ç‚¹æµ‹è¯•**
  - Bills API (GET, POST, æ–‡ä»¶ä¸Šä¼ )
  - Assets API (CRUDæ“ä½œ)
  - Logs API (æ—¥å¿—è·å–å’Œç­›é€‰)
  
- **ä¸­é—´ä»¶æµ‹è¯•**
  - CORSé…ç½®
  - é”™è¯¯å¤„ç†ä¸­é—´ä»¶
  - JSON/è¡¨å•æ•°æ®è§£æ

- **ç³»ç»Ÿé›†æˆæµ‹è¯•**
  - æ•°æ®åº“æ“ä½œé›†æˆ
  - æ–‡ä»¶ç³»ç»Ÿæ“ä½œ
  - å®Œæ•´è¯·æ±‚-å“åº”æµç¨‹

#### æµ‹è¯•ç‰¹ç‚¹
- ä½¿ç”¨SuperTestæ¨¡æ‹ŸHTTPè¯·æ±‚
- æ¨¡æ‹Ÿæ•°æ®åº“å’Œæ–‡ä»¶ç³»ç»Ÿ
- æµ‹è¯•å®Œæ•´çš„APIäº¤äº’æµç¨‹

### 3. å†’çƒŸæµ‹è¯• (Smoke Tests)

**ä½ç½®**: `backend/src/__tests__/smoke/`

#### æµ‹è¯•æ–‡ä»¶ç»“æ„
```
backend/src/__tests__/smoke/
â””â”€â”€ smoke.test.ts           # ç³»ç»Ÿå¥åº·æ£€æŸ¥
```

#### è¦†ç›–åŠŸèƒ½
- **ç¯å¢ƒæ£€æŸ¥**
  - Node.jsè¿è¡Œæ—¶æ£€æŸ¥
  - ç¯å¢ƒå˜é‡éªŒè¯
  - æ–‡ä»¶ç³»ç»Ÿæƒé™

- **ä¾èµ–éªŒè¯**
  - æ ¸å¿ƒä¾èµ–å¯ç”¨æ€§ (Express, SQLite, Winstonç­‰)
  - é…ç½®æ–‡ä»¶å®Œæ•´æ€§ (package.json, tsconfig.json)
  - æ¨¡å—å¯¼å…¥æµ‹è¯•

- **ç³»ç»Ÿèµ„æº**
  - å†…å­˜ä½¿ç”¨æ£€æŸ¥
  - åŸºæœ¬APIå¥åº·æ£€æŸ¥
  - æ•°æ®åº“è¿æ¥æµ‹è¯•

#### æµ‹è¯•ç‰¹ç‚¹
- å¿«é€Ÿæ‰§è¡Œ (< 30ç§’)
- éªŒè¯ç³»ç»ŸåŸºæœ¬å¯ç”¨æ€§
- é€‚åˆCI/CDæµæ°´çº¿å‰ç½®æ£€æŸ¥

### 4. ç«¯åˆ°ç«¯æµ‹è¯• (E2E Tests)

**ä½ç½®**: `frontend/tests/e2e/`

#### æµ‹è¯•æ–‡ä»¶ç»“æ„
```
frontend/tests/e2e/
â””â”€â”€ e2e.test.ts             # ç”¨æˆ·äº¤äº’æµç¨‹æµ‹è¯•
```

#### è¦†ç›–åŠŸèƒ½
- **å¯¼èˆªåŠŸèƒ½**
  - é¡µé¢é—´è·³è½¬
  - è·¯ç”±æ­£ç¡®æ€§
  - èœå•äº¤äº’

- **ä¸šåŠ¡æµç¨‹**
  - è´¦å•ç®¡ç†å®Œæ•´æµç¨‹
  - èµ„äº§æ·»åŠ /ç¼–è¾‘æµç¨‹
  - æ•°æ®ç­›é€‰å’ŒæŸ¥è¯¢
  - æ–‡ä»¶ä¸Šä¼ æµç¨‹

- **ç”¨æˆ·ä½“éªŒ**
  - è¡¨å•éªŒè¯
  - åŠ è½½çŠ¶æ€
  - é”™è¯¯å¤„ç†
  - å“åº”å¼è®¾è®¡

- **ç³»ç»Ÿç¨³å®šæ€§**
  - ç½‘ç»œé”™è¯¯å¤„ç†
  - APIå¼‚å¸¸å¤„ç†
  - æ€§èƒ½æµ‹è¯•

#### æµ‹è¯•ç‰¹ç‚¹
- ä½¿ç”¨Playwrightè¿›è¡Œæµè§ˆå™¨è‡ªåŠ¨åŒ–
- æ¨¡æ‹ŸçœŸå®ç”¨æˆ·æ“ä½œ
- è·¨æµè§ˆå™¨å…¼å®¹æ€§æµ‹è¯•
- å“åº”å¼è®¾è®¡éªŒè¯

## ğŸ› ï¸ æµ‹è¯•å·¥å…·å’Œé…ç½®

### æµ‹è¯•å·¥å…·ç±»

**ä½ç½®**: `backend/src/__tests__/setup/test-setup.ts`

#### æ ¸å¿ƒå·¥å…·
- **TestDatabase** - æµ‹è¯•æ•°æ®åº“ç®¡ç†
- **TestHelper** - é€šç”¨æµ‹è¯•è¾…åŠ©å‡½æ•°
- **MockDataGenerator** - æ¨¡æ‹Ÿæ•°æ®ç”Ÿæˆå™¨
- **PerformanceHelper** - æ€§èƒ½æµ‹è¯•å·¥å…·
- **ErrorSimulator** - é”™è¯¯åœºæ™¯æ¨¡æ‹Ÿ

#### è‡ªå®šä¹‰æ–­è¨€
- **toBeValidBill** - éªŒè¯è´¦å•å¯¹è±¡
- **toBeValidAsset** - éªŒè¯èµ„äº§å¯¹è±¡  
- **toBeValidDate** - éªŒè¯æ—¥æœŸæ ¼å¼

### æµ‹è¯•é…ç½®

#### Jesté…ç½® (åç«¯)
```javascript
// jest.config.js
module.exports = {
  preset: 'ts-jest',
  testEnvironment: 'node',
  roots: ['<rootDir>/src'],
  testMatch: ['**/__tests__/**/*.test.ts'],
  collectCoverageFrom: [
    'src/**/*.ts',
    '!src/__tests__/**',
    '!src/types/**'
  ]
};
```

#### Playwrighté…ç½® (å‰ç«¯)
```javascript
// playwright.config.ts
export default {
  testDir: './tests/e2e',
  timeout: 30000,
  use: {
    baseURL: 'http://localhost:5173',
    screenshot: 'only-on-failure',
    video: 'retain-on-failure'
  }
};
```

## ğŸš€ è¿è¡Œæµ‹è¯•

### ä½¿ç”¨æµ‹è¯•è¿è¡Œå™¨

æˆ‘ä»¬æä¾›äº†ç»Ÿä¸€çš„æµ‹è¯•è¿è¡Œå™¨è„šæœ¬ `test-runner.js`ï¼š

```bash
# è¿è¡Œæ‰€æœ‰æµ‹è¯•
node test-runner.js

# è¿è¡Œç‰¹å®šç±»å‹çš„æµ‹è¯•
node test-runner.js unit           # å•å…ƒæµ‹è¯•
node test-runner.js integration    # é›†æˆæµ‹è¯•
node test-runner.js smoke          # å†’çƒŸæµ‹è¯•
node test-runner.js e2e            # ç«¯åˆ°ç«¯æµ‹è¯•

# ä½¿ç”¨é€‰é¡¹
node test-runner.js unit --coverage    # ç”Ÿæˆè¦†ç›–ç‡æŠ¥å‘Š
node test-runner.js all --watch         # ç›‘è§†æ¨¡å¼
node test-runner.js all --bail          # é‡åˆ°å¤±è´¥å³åœæ­¢
node test-runner.js --help              # æ˜¾ç¤ºå¸®åŠ©
```

### æ‰‹åŠ¨è¿è¡Œæµ‹è¯•

#### åç«¯æµ‹è¯•
```bash
cd backend

# å•å…ƒæµ‹è¯•
npm test -- --testPathPattern=".*\.test\.(ts|js)$"

# é›†æˆæµ‹è¯•  
npm test -- --testPathPattern="integration.*\.test\.(ts|js)$"

# å†’çƒŸæµ‹è¯•
npm test -- --testPathPattern="smoke.*\.test\.(ts|js)$"

# ç”Ÿæˆè¦†ç›–ç‡æŠ¥å‘Š
npm test -- --coverage
```

#### å‰ç«¯æµ‹è¯•
```bash
cd frontend

# ç«¯åˆ°ç«¯æµ‹è¯•
npx playwright test

# ç”Ÿæˆæµ‹è¯•æŠ¥å‘Š
npx playwright show-report
```

## ğŸ“Š æµ‹è¯•æŠ¥å‘Šå’Œè¦†ç›–ç‡

### è¦†ç›–ç‡ç›®æ ‡
- **å•å…ƒæµ‹è¯•è¦†ç›–ç‡**: > 80%
- **é›†æˆæµ‹è¯•è¦†ç›–ç‡**: > 70%
- **å…³é”®è·¯å¾„è¦†ç›–**: 100%

### æŠ¥å‘Šç”Ÿæˆ
- **HTMLè¦†ç›–ç‡æŠ¥å‘Š**: `backend/coverage/lcov-report/index.html`
- **Playwrightæµ‹è¯•æŠ¥å‘Š**: `frontend/playwright-report/index.html`
- **JUnit XMLæŠ¥å‘Š**: æ”¯æŒCI/CDé›†æˆ

## ğŸ”„ CI/CD é›†æˆ

### GitHub Actions ç¤ºä¾‹
```yaml
name: Test Suite
on: [push, pull_request]

jobs:
  test:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3
      
      - name: Setup Node.js
        uses: actions/setup-node@v3
        with:
          node-version: '18'
          
      - name: Install dependencies
        run: node test-runner.js --install-only
        
      - name: Run smoke tests
        run: node test-runner.js smoke
        
      - name: Run unit tests
        run: node test-runner.js unit --coverage
        
      - name: Run integration tests
        run: node test-runner.js integration
        
      - name: Run E2E tests
        run: node test-runner.js e2e
        
      - name: Upload coverage
        uses: codecov/codecov-action@v3
```

## ğŸ¯ æµ‹è¯•æœ€ä½³å®è·µ

### 1. æµ‹è¯•å‘½åè§„èŒƒ
- ä½¿ç”¨æè¿°æ€§çš„æµ‹è¯•åç§°
- éµå¾ª "åº”è¯¥...å½“...æ—¶" çš„æ¨¡å¼
- ä½¿ç”¨ä¸­æ–‡æè¿°å¢å¼ºå¯è¯»æ€§

### 2. æµ‹è¯•æ•°æ®ç®¡ç†
- ä½¿ç”¨å†…å­˜æ•°æ®åº“è¿›è¡Œéš”ç¦»
- æ¯ä¸ªæµ‹è¯•åæ¸…ç†æ•°æ®
- ä½¿ç”¨MockDataGeneratorç”Ÿæˆæµ‹è¯•æ•°æ®

### 3. é”™è¯¯å¤„ç†æµ‹è¯•
- æµ‹è¯•æ‰€æœ‰é”™è¯¯è·¯å¾„
- éªŒè¯é”™è¯¯æ¶ˆæ¯çš„å‡†ç¡®æ€§
- æ¨¡æ‹Ÿå„ç§å¼‚å¸¸æƒ…å†µ

### 4. æ€§èƒ½æµ‹è¯•
- è®¾ç½®åˆç†çš„è¶…æ—¶æ—¶é—´
- ç›‘æ§æµ‹è¯•æ‰§è¡Œæ—¶é—´
- é¿å…ä¸å¿…è¦çš„ç­‰å¾…

### 5. ç»´æŠ¤æ€§
- å®šæœŸæ›´æ–°æµ‹è¯•ç”¨ä¾‹
- åŠæ—¶ä¿®å¤å¤±è´¥çš„æµ‹è¯•
- ä¿æŒæµ‹è¯•å’Œä»£ç åŒæ­¥

## ğŸ› å¸¸è§é—®é¢˜

### 1. æµ‹è¯•ç¯å¢ƒé—®é¢˜
**é—®é¢˜**: æµ‹è¯•æ•°æ®åº“è¿æ¥å¤±è´¥
**è§£å†³**: ç¡®ä¿ä½¿ç”¨å†…å­˜æ•°æ®åº“ï¼Œæ£€æŸ¥better-sqlite3ä¾èµ–

### 2. E2Eæµ‹è¯•é—®é¢˜
**é—®é¢˜**: Playwrightæµè§ˆå™¨å¯åŠ¨å¤±è´¥
**è§£å†³**: è¿è¡Œ `npx playwright install` å®‰è£…æµè§ˆå™¨

### 3. è¦†ç›–ç‡é—®é¢˜
**é—®é¢˜**: è¦†ç›–ç‡æŠ¥å‘Šä¸å‡†ç¡®
**è§£å†³**: æ£€æŸ¥Jesté…ç½®ä¸­çš„collectCoverageFromè®¾ç½®

### 4. æ€§èƒ½é—®é¢˜
**é—®é¢˜**: æµ‹è¯•è¿è¡Œç¼“æ…¢
**è§£å†³**: ä½¿ç”¨--bailé€‰é¡¹å¿«é€Ÿå¤±è´¥ï¼Œä¼˜åŒ–æµ‹è¯•æ•°æ®å¤§å°

## ğŸ“ æ›´æ–°æ—¥å¿—

### v1.0.0 (2024-01-XX)
- âœ… åˆå§‹æµ‹è¯•å¥—ä»¶åˆ›å»º
- âœ… å•å…ƒæµ‹è¯•è¦†ç›–æ‰€æœ‰æ ¸å¿ƒæ¨¡å—
- âœ… é›†æˆæµ‹è¯•è¦†ç›–æ‰€æœ‰APIç«¯ç‚¹
- âœ… å†’çƒŸæµ‹è¯•éªŒè¯ç³»ç»Ÿå¥åº·
- âœ… E2Eæµ‹è¯•è¦†ç›–ä¸»è¦ç”¨æˆ·æµç¨‹
- âœ… ç»Ÿä¸€æµ‹è¯•è¿è¡Œå™¨è„šæœ¬
- âœ… å®Œæ•´çš„æµ‹è¯•å·¥å…·å’Œè¾…åŠ©ç±»

## ğŸ¤ è´¡çŒ®æŒ‡å—

1. æ·»åŠ æ–°åŠŸèƒ½æ—¶ï¼Œè¯·åŒæ—¶æ·»åŠ ç›¸åº”çš„æµ‹è¯•
2. ç¡®ä¿æ‰€æœ‰æµ‹è¯•é€šè¿‡åå†æäº¤ä»£ç 
3. éµå¾ªç°æœ‰çš„æµ‹è¯•å‘½åå’Œç»“æ„è§„èŒƒ
4. æ›´æ–°ç›¸å…³æ–‡æ¡£å’Œæµ‹è¯•ç”¨ä¾‹

## ğŸ“ æ”¯æŒ

å¦‚æœ‰é—®é¢˜æˆ–å»ºè®®ï¼Œè¯·ï¼š
1. æŸ¥çœ‹æœ¬æ–‡æ¡£çš„å¸¸è§é—®é¢˜éƒ¨åˆ†
2. è¿è¡Œ `node test-runner.js --help` æŸ¥çœ‹å‘½ä»¤å¸®åŠ©
3. æäº¤Issueæˆ–è”ç³»å¼€å‘å›¢é˜Ÿ 